<div class="container-wrapper">
  <div class="flex-header">
    <h1 class="dashboard-title">Dashboard</h1>
    <span style="flex:1"></span>
    @if (projects().length !== 0 && projectStore.loading()) {
    <mat-progress-spinner diameter="28" mode="indeterminate" color="primary" />
    }
  </div>

  <div class="status-cards">
    <mat-card class="status-card total">
      <mat-card-header class="centered-flexbox">
        <mat-icon mat-card-avatar class="centered-logo">layers</mat-icon>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ projects().length }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="status-card stopped">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">stop</mat-icon>
        <mat-card-title>Stopped</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ containerStats().stopped }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="status-card updated">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">check_circle</mat-icon>
        <mat-card-title>Running</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ containerStats().running }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="status-card needs-update">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">new_releases</mat-icon>
        <mat-card-title class="text-sm">Updates</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ containerStats().needsUpdate }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="status-card updating">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">loop</mat-icon>
        <mat-card-title>Updating</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ containerStats().updating }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="status-card failed">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">error</mat-icon>
        <mat-card-title>Crashed</mat-card-title>
      </mat-card-header>
      <mat-card-content class="card-content">
        <span class="count">{{ containerStats().crashed }}</span>
      </mat-card-content>
    </mat-card>
  </div>

  @if (projects().length !== 0) {
  <div class="container-list">
    @for (project of projects(); track project.dockerProjectName) {
    <mat-card appearance="outlined">
      <mat-card-header>
        <mat-icon mat-card-avatar class="centered-logo">
          {{ getProjectStatusIcon(project) }}
        </mat-icon>
        <mat-card-title-group>
          <mat-card-title>{{ project.projectName }}</mat-card-title>
          <mat-card-subtitle class="project-description">
            {{ project.projectDescription }}
          </mat-card-subtitle>
        </mat-card-title-group>
      </mat-card-header>
      <mat-card-content>
        <p>Containers: {{ getRunningCount(project) }}/{{ getTotalCount(project) }} running</p>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/project', project.dockerProjectName]">View</button>
        <button mat-icon-button [matMenuTriggerFor]="projectMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #projectMenu="matMenu">
          <a mat-menu-item [routerLink]="['/project', project.dockerProjectName]">
            <mat-icon>visibility</mat-icon>
            <span>View</span>
          </a>
          <button mat-menu-item (click)="onStopProject(project)" [disabled]="projectStore.loading()">
            <mat-icon>stop</mat-icon>
            <span>Stop project</span>
          </button>
          <button mat-menu-item (click)="onRestartProject(project)" [disabled]="projectStore.loading()">
            <mat-icon>refresh</mat-icon>
            <span>Restart project</span>
          </button>
          @if (canUpdateProject(project)) {
            <button mat-menu-item (click)="onUpdateProject(project)" [disabled]="projectStore.loading()">
              <mat-icon>system_update</mat-icon>
              <span>Update (pull &amp; restart)</span>
            </button>
          }
        </mat-menu>
      </mat-card-actions>
    </mat-card>
    }
  </div>
  }

  @if (projects().length === 0 && !projectStore.loading()) {
  <div class="container-list">
    <mat-card class="empty-state">
      <mat-card-content>
        <p>No compose stacks found. Add your first compose stack to get started.</p>
        <app-create-project-button />
      </mat-card-content>
    </mat-card>
  </div>
  }

  @if (projects().length === 0 && projectStore.loading()) {
  <div class="loading-state">
    <mat-progress-bar mode="indeterminate" />
  </div>
  }
</div>
